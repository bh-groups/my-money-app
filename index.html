
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Finance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-danger {
            background-color: #dc2626;
            color: white;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
         .btn-danger:hover {
            background-color: #b91c1c;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.2);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">Zenith Finance Tracker</h1>
            <p class="text-gray-500 mt-2">Your complete financial overview for the month.</p>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Dashboard & Form -->
            <div class="lg:col-span-1 flex flex-col gap-8">
                <!-- Dashboard -->
                <div class="card">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Monthly Dashboard</h2>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                            <span class="font-medium text-green-700">Total Income</span>
                            <span id="total-income" class="font-bold text-lg text-green-800">₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                            <span class="font-medium text-red-700">Total Expenses</span>
                            <span id="total-expenses" class="font-bold text-lg text-red-800">₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                            <span class="font-medium text-yellow-700">Total EMIs</span>
                            <span id="total-emis" class="font-bold text-lg text-yellow-800">₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-blue-50 rounded-lg mt-4 border-t-4 border-blue-500">
                            <span class="font-semibold text-xl text-blue-800">Cash in Hand</span>
                            <span id="cash-in-hand" class="font-bold text-2xl text-blue-900">₹0.00</span>
                        </div>
                        <button id="export-btn" class="btn bg-gray-600 hover:bg-gray-700 text-white w-full mt-4">Export Data to CSV</button>
                    </div>
                </div>

                <!-- Add Transaction Form -->
                <div class="card">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Add New Transaction</h2>
                    <form id="transaction-form" class="space-y-4">
                        <div>
                            <label for="type" class="block text-sm font-medium text-gray-600 mb-1">Type</label>
                            <select id="type" class="form-select">
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                                <option value="emi">EMI</option>
                            </select>
                        </div>
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-600 mb-1">Name / Description</label>
                            <input type="text" id="name" class="form-input" placeholder="e.g., Salary, Groceries, Phone Loan" required>
                        </div>
                        
                        <!-- Expense Category Field -->
                        <div id="expense-category-field">
                            <label for="category" class="block text-sm font-medium text-gray-600 mb-1">Category</label>
                            <select id="category" class="form-select">
                                <option value="Food">Food</option>
                                <option value="Transport">Transport</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Shopping">Shopping</option>
                                <option value="Health">Health</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <!-- Amount/Monthly Payment Field -->
                        <div>
                            <label for="amount" id="amount-label" class="block text-sm font-medium text-gray-600 mb-1">Amount</label>
                            <input type="number" id="amount" class="form-input" placeholder="e.g., 50000" required min="0.01" step="0.01">
                        </div>

                        <!-- EMI Specific Fields -->
                        <div id="emi-fields" class="hidden space-y-4">
                            <div>
                                <label for="emi-total" class="block text-sm font-medium text-gray-600 mb-1">Total Loan Amount</label>
                                <input type="number" id="emi-total" class="form-input" placeholder="e.g., 60000" min="0.01" step="0.01">
                            </div>
                            <div>
                                <label for="emi-start-date" class="block text-sm font-medium text-gray-600 mb-1">Start Date</label>
                                <input type="date" id="emi-start-date" class="form-input">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary w-full">Add Transaction</button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Lists & Insights -->
            <div class="lg:col-span-2 flex flex-col gap-8">
                <!-- Transactions Lists -->
                <div class="card">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4">Income</h3>
                            <ul id="income-list" class="space-y-2">
                                <!-- Income items will be injected here -->
                            </ul>
                        </div>
                        <div>
                             <h3 class="text-xl font-semibold text-gray-700 mb-4">Expenses</h3>
                            <ul id="expense-list" class="space-y-2">
                                <!-- Expense items will be injected here -->
                            </ul>
                        </div>
                    </div>
                     <div class="mt-8">
                         <h3 class="text-xl font-semibold text-gray-700 mb-4">EMIs</h3>
                         <div id="emi-list" class="space-y-3">
                            <!-- EMI items will be injected here -->
                         </div>
                    </div>
                </div>

                <!-- Cost Cutting Insights -->
                <div class="card">
                    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Cost Cutting Insights</h2>
                    <div class="flex flex-col md:flex-row gap-8 items-center">
                        <div class="w-full md:w-1/2">
                           <canvas id="expenseChart"></canvas>
                        </div>
                        <div id="cost-suggestions" class="w-full md:w-1/2 space-y-3">
                            <p class="text-gray-600">Your spending habits will be analyzed here. Add some expenses to get started!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="custom-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="card w-full max-w-md">
            <p id="modal-message" class="text-gray-700 text-lg mb-6"></p>
            <div id="modal-buttons" class="flex justify-end gap-4">
                <button id="modal-cancel" class="btn bg-gray-300 hover:bg-gray-400 text-gray-800">Cancel</button>
                <button id="modal-ok" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const transactionForm = document.getElementById('transaction-form');
            const typeSelect = document.getElementById('type');
            const amountLabel = document.getElementById('amount-label');
            const emiFields = document.getElementById('emi-fields');
            const expenseCategoryField = document.getElementById('expense-category-field');
            const exportBtn = document.getElementById('export-btn');

            // Modal elements
            const modal = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalOk = document.getElementById('modal-ok');
            const modalCancel = document.getElementById('modal-cancel');
            let confirmResolve = null;

            let chartInstance = null;

            // State management
            let state = {
                incomes: JSON.parse(localStorage.getItem('incomes')) || [],
                expenses: JSON.parse(localStorage.getItem('expenses')) || [],
                emis: JSON.parse(localStorage.getItem('emis')) || []
            };

            // --- Modal Logic ---
            function showModal(message, type = 'alert') {
                modalMessage.textContent = message;
                modalCancel.classList.toggle('hidden', type === 'alert');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                
                return new Promise((resolve) => {
                    confirmResolve = resolve;
                });
            }

            function hideModal() {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }

            modalOk.addEventListener('click', () => {
                hideModal();
                if (confirmResolve) confirmResolve(true);
            });

            modalCancel.addEventListener('click', () => {
                hideModal();
                if (confirmResolve) confirmResolve(false);
            });


            // Toggle form fields based on type
            typeSelect.addEventListener('change', () => {
                const type = typeSelect.value;
                if (type === 'emi') {
                    emiFields.classList.remove('hidden');
                    expenseCategoryField.classList.add('hidden');
                    amountLabel.textContent = 'Monthly Payment';
                } else if (type === 'expense') {
                    emiFields.classList.add('hidden');
                    expenseCategoryField.classList.remove('hidden');
                    amountLabel.textContent = 'Amount';
                } else {
                    emiFields.classList.add('hidden');
                    expenseCategoryField.classList.add('hidden');
                    amountLabel.textContent = 'Amount';
                }
            });
            typeSelect.dispatchEvent(new Event('change')); // Initial setup

            // Form submission
            transactionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const type = typeSelect.value;
                const name = document.getElementById('name').value;
                const amount = parseFloat(document.getElementById('amount').value);
                
                const transaction = {
                    id: Date.now(),
                    name,
                    amount
                };

                if (type === 'income') {
                    state.incomes.push(transaction);
                } else if (type === 'expense') {
                    transaction.category = document.getElementById('category').value;
                    state.expenses.push(transaction);
                } else if (type === 'emi') {
                    transaction.total = parseFloat(document.getElementById('emi-total').value);
                    transaction.startDate = document.getElementById('emi-start-date').value;
                    if (isNaN(transaction.total) || !transaction.startDate) {
                        showModal('Please fill in Total Loan Amount and Start Date for EMIs.', 'alert');
                        return;
                    }
                    state.emis.push(transaction);
                }

                saveAndRender();
                transactionForm.reset();
                typeSelect.dispatchEvent(new Event('change'));
            });

            function saveState() {
                localStorage.setItem('incomes', JSON.stringify(state.incomes));
                localStorage.setItem('expenses', JSON.stringify(state.expenses));
                localStorage.setItem('emis', JSON.stringify(state.emis));
            }

            function render() {
                // Render Dashboard
                const totalIncome = state.incomes.reduce((sum, i) => sum + i.amount, 0);
                const totalExpenses = state.expenses.reduce((sum, e) => sum + e.amount, 0);
                const totalEmis = state.emis.reduce((sum, e) => sum + e.amount, 0);
                const cashInHand = totalIncome - totalExpenses - totalEmis;

                document.getElementById('total-income').textContent = `₹${totalIncome.toFixed(2)}`;
                document.getElementById('total-expenses').textContent = `₹${totalExpenses.toFixed(2)}`;
                document.getElementById('total-emis').textContent = `₹${totalEmis.toFixed(2)}`;
                document.getElementById('cash-in-hand').textContent = `₹${cashInHand.toFixed(2)}`;
                
                // Render Lists
                renderList('income-list', state.incomes);
                renderList('expense-list', state.expenses, true);
                renderEmiList('emi-list', state.emis);

                // Render Insights
                renderInsights();
            }
            
            function renderList(listId, items, showCategory = false) {
                const listElement = document.getElementById(listId);
                listElement.innerHTML = '';
                if (items.length === 0) {
                    listElement.innerHTML = `<li class="text-gray-500 italic">No items yet.</li>`;
                    return;
                }
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-md';
                    li.innerHTML = `
                        <div>
                            <span class="font-medium">${item.name}</span>
                            ${showCategory ? `<span class="text-sm text-gray-500 ml-2 bg-gray-200 px-2 py-1 rounded-full">${item.category}</span>` : ''}
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-semibold">₹${item.amount.toFixed(2)}</span>
                            <button class="btn-danger" data-id="${item.id}" data-type="${listId.split('-')[0]}s">X</button>
                        </div>
                    `;
                    listElement.appendChild(li);
                });
            }

            function renderEmiList(listId, items) {
                const listElement = document.getElementById(listId);
                listElement.innerHTML = '';
                 if (items.length === 0) {
                    listElement.innerHTML = `<p class="text-gray-500 italic">No EMIs added yet.</p>`;
                    return;
                }
                items.forEach(item => {
                    const { remainingMonths, endDateFormatted } = calculateEmiDetails(item);
                    const div = document.createElement('div');
                    div.className = 'p-3 bg-gray-50 rounded-lg border-l-4 border-yellow-400';
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-semibold">${item.name}</p>
                                <p class="text-sm text-gray-600">Monthly: <span class="font-medium">₹${item.amount.toFixed(2)}</span> | Total: <span class="font-medium">₹${item.total.toFixed(2)}</span></p>
                            </div>
                             <button class="btn-danger" data-id="${item.id}" data-type="emis">X</button>
                        </div>
                        <div class="mt-2 text-sm">
                            ${remainingMonths > 0
                                ? `<p>Ends in: <span class="font-semibold text-blue-600">${remainingMonths} months</span> (around ${endDateFormatted})</p>`
                                : `<p class="font-semibold text-green-600">Completed!</p>`
                            }
                        </div>
                    `;
                     listElement.appendChild(div);
                });
            }

            function calculateEmiDetails(emi) {
                const totalMonths = Math.ceil(emi.total / emi.amount);
                const startDate = new Date(emi.startDate);
                const today = new Date();

                // Set day to a consistent value to avoid month-end issues
                startDate.setDate(1);
                today.setDate(1);

                let monthsPassed = (today.getFullYear() - startDate.getFullYear()) * 12;
                monthsPassed -= startDate.getMonth();
                monthsPassed += today.getMonth();
                
                const remainingMonths = Math.max(0, totalMonths - monthsPassed -1);

                const endDate = new Date(startDate);
                endDate.setMonth(startDate.getMonth() + totalMonths -1);
                const endDateFormatted = endDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

                return { remainingMonths, endDateFormatted };
            }

            function renderInsights() {
                const suggestionsContainer = document.getElementById('cost-suggestions');
                const ctx = document.getElementById('expenseChart').getContext('2d');
                
                if (state.expenses.length === 0) {
                    suggestionsContainer.innerHTML = `<p class="text-gray-600">Your spending habits will be analyzed here. Add some expenses to get started!</p>`;
                    if (chartInstance) {
                        chartInstance.destroy();
                        chartInstance = null;
                    }
                    return;
                }

                const categorySpending = state.expenses.reduce((acc, expense) => {
                    acc[expense.category] = (acc[expense.category] || 0) + expense.amount;
                    return acc;
                }, {});

                const sortedCategories = Object.entries(categorySpending).sort(([, a], [, b]) => b - a);
                
                // Update Suggestions
                suggestionsContainer.innerHTML = '<h3 class="font-semibold text-lg text-gray-800 mb-2">Top Spending Categories:</h3>';
                const suggestionsList = document.createElement('ul');
                suggestionsList.className = 'list-disc list-inside space-y-2 text-gray-700';
                
                sortedCategories.slice(0, 3).forEach(([category, amount]) => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="font-medium">${category}:</span> ₹${amount.toFixed(2)}`;
                    suggestionsList.appendChild(li);
                });
                suggestionsContainer.appendChild(suggestionsList);
                suggestionsContainer.innerHTML += `<p class="mt-4 text-sm text-gray-500">Consider reviewing your spending in these areas to find potential savings.</p>`;
                
                // Update Chart
                const chartLabels = Object.keys(categorySpending);
                const chartData = Object.values(categorySpending);
                const backgroundColors = ['#34d399', '#fbbf24', '#60a5fa', '#f87171', '#a78bfa', '#fb923c', '#818cf8'];

                if (chartInstance) {
                    chartInstance.data.labels = chartLabels;
                    chartInstance.data.datasets[0].data = chartData;
                    chartInstance.update();
                } else {
                    chartInstance = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: chartLabels,
                            datasets: [{
                                label: 'Expenses by Category',
                                data: chartData,
                                backgroundColor: backgroundColors,
                                hoverOffset: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: 'Expense Breakdown'
                                }
                            }
                        }
                    });
                }
            }
            
            // --- Export to CSV ---
            function exportDataToCSV() {
                const { incomes, expenses, emis } = state;
                if (incomes.length === 0 && expenses.length === 0 && emis.length === 0) {
                    showModal('No data to export.', 'alert');
                    return;
                }

                const headers = ['Type', 'Name', 'Amount', 'Category', 'Total Loan', 'Start Date'];
                let csvContent = headers.join(',') + '\n';

                const formatCell = (cellData) => {
                    const stringData = String(cellData === null || cellData === undefined ? '' : cellData);
                    if (stringData.includes(',') || stringData.includes('"') || stringData.includes('\n')) {
                        return `"${stringData.replace(/"/g, '""')}"`;
                    }
                    return stringData;
                };

                incomes.forEach(item => {
                    const row = ['Income', item.name, item.amount, '', '', ''];
                    csvContent += row.map(formatCell).join(',') + '\n';
                });

                expenses.forEach(item => {
                    const row = ['Expense', item.name, item.amount, item.category, '', ''];
                    csvContent += row.map(formatCell).join(',') + '\n';
                });

                emis.forEach(item => {
                    const row = ['EMI', item.name, item.amount, '', item.total, item.startDate];
                    csvContent += row.map(formatCell).join(',') + '\n';
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                const today = new Date().toISOString().slice(0, 10);
                link.setAttribute("download", `finance_data_${today}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            exportBtn.addEventListener('click', exportDataToCSV);

            // Delete functionality
            document.querySelector('.lg\\:col-span-2').addEventListener('click', async (e) => {
                if (e.target.matches('.btn-danger')) {
                    const id = parseInt(e.target.dataset.id);
                    const type = e.target.dataset.type;
                    
                    const shouldDelete = await showModal('Are you sure you want to delete this item?', 'confirm');
                    if (shouldDelete) {
                        state[type] = state[type].filter(item => item.id !== id);
                        saveAndRender();
                    }
                }
            });

            function saveAndRender() {
                saveState();
                render();
            }

            // Initial render
            render();
        });
    </script>
</body>
</html>

